"use strict";function initCheckoutcomApplePayValidation(){$("button.submit-payment").off("click touch").one("click touch",(function(e){"CHECKOUTCOM_APPLE_PAY"===$('input[name="dwfrm_billing_paymentMethod"]').val()&&(e.preventDefault(),e.stopImmediatePropagation(),""===$('input[name="dwfrm_billing_applePayForm_ckoApplePayData"]').val()?$("#apple-pay-content .invalid-field-message").text(window.ckoLang.applePayDataInvalid):$(this).trigger("click"))}))}function getLineItems(){return[]}function getSupportedNetworks(){return"SA"==jQuery('[id="ckoApplePaySiteCountry"]').val()?["amex","masterCard","visa","mada"]:["amex","masterCard","visa"]}function getMerchantCapabilities(){return["supportsCredit","supportsDebit"]}function performValidation(e){var t=jQuery('[id="ckoApplePayValidationUrl"]').val()+"?u="+e;return new Promise((function(e,n){var a=new XMLHttpRequest;a.onload=function(){var t=JSON.parse(this.responseText);e(t)},a.onerror=n,a.open("GET",t),a.send()}))}function sendPaymentRequest(e){return new Promise((function(e,t){e(!0)}))}function launchApplePay(){if(window.ApplePaySession){var e=jQuery('[id="ckoApplePayMerchantId"]').val();ApplePaySession.canMakePaymentsWithActiveCard(e).then((function(e){e&&jQuery(".ckoApplePayButton").show()})).catch((function(e){console.log(e)}))}else jQuery(".apple-pay-tab").parent().hide(),jQuery(".ckoApplePayButton").hide();jQuery(".apple-pay-button").click((function(e){var t=jQuery('[id="ckoApplePayAmount"]').val(),n={currencyCode:jQuery('[id="ckoApplePayCurrency"]').val(),countryCode:jQuery('[id="ckoApplePaySiteCountry"]').val(),total:{label:jQuery('[id="ckoApplePaySiteName"]').val(),amount:t},supportedNetworks:getSupportedNetworks(),merchantCapabilities:getMerchantCapabilities()},a=new ApplePaySession(1,n);a.onvalidatemerchant=function(e){performValidation(e.validationURL).then((function(e){a.completeMerchantValidation(e)})).catch((function(e){console.log(e)}))},a.onshippingcontactselected=function(e){var n=ApplePaySession.STATUS_SUCCESS,o={type:"final",label:jQuery('[id="ckoApplePaySiteName"]').val(),amount:t};a.completeShippingContactSelection(n,[],o,getLineItems())},a.onshippingmethodselected=function(e){var n=ApplePaySession.STATUS_SUCCESS,o={type:"final",label:jQuery('[id="ckoApplePaySiteName"]').val(),amount:t};a.completeShippingMethodSelection(n,o,getLineItems())},a.onpaymentmethodselected=function(e){var n={type:"final",label:jQuery('[id="ckoApplePaySiteName"]').val(),amount:t};a.completePaymentMethodSelection(n,getLineItems())},a.onpaymentauthorized=function(e){var t=e.payment.token;sendPaymentRequest(t).then((function(e){var n;n=e?ApplePaySession.STATUS_SUCCESS:ApplePaySession.STATUS_FAILURE,a.completePayment(n),e&&jQuery('[id="ckoApplePayData"]').val(JSON.stringify(t))})).catch((function(e){console.log(e)}))},a.oncancel=function(e){console.log(e)},a.begin()}))}document.addEventListener("DOMContentLoaded",(function(){launchApplePay()}),!1);