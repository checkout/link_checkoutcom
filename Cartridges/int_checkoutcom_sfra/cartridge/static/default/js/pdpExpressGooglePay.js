"use strict";function launchGooglePay(){jQuery(".google-pay-button").click((function(){$.ajax({url:document.getElementById("ckoCreateBasketForPDP").value,data:{pid:jQuery('[id="ckoProductID"]').val()},method:"POST",success:function(e){console.log(e)},error:function(e){console.log(e)}});const e={apiVersion:2,apiVersionMinor:0},t=["AMEX","DISCOVER","JCB","MASTERCARD","VISA"],a=["PAN_ONLY","CRYPTOGRAM_3DS"],o={type:"PAYMENT_GATEWAY",parameters:{gateway:"checkoutltd",gatewayMerchantId:jQuery('[id="ckoGatewayMerchantId"]').val()}},n={type:"CARD",parameters:{allowedAuthMethods:a,allowedCardNetworks:t}},r={type:"TOKENIZED_CARD",parameters:{allowedAuthMethods:a,allowedCardNetworks:t}},i=Object.assign({},n,{tokenizationSpecification:o}),s=Object.assign({},r,{tokenizationSpecification:o});var c,l;let d=null;var u,p,g,h=[];$.ajax({url:document.getElementById("ckoGetShippingMethods").value,method:"POST",success:function(e){u=e.shipMethods,p=e.shipCosts,h=e.salesTax,c=e.discounts,l=e.productDiscountTotal},error:function(e){console.log(e)}}),m().isReadyToPay(Object.assign({},e,{allowedPaymentMethods:[i,s]})).then((function(e){e.result&&function(){var e=f();e.transactionInfo={totalPriceStatus:"NOT_CURRENTLY_KNOWN",currencyCode:jQuery('[id="ckoGooglePayCurrency"]').val()},m().prefetchPaymentData(e)}()})).catch((function(e){console.log(e)}));var y=f();function m(){return null===d&&(d=new google.payments.api.PaymentsClient({environment:"TEST",merchantInfo:{merchantName:"Example Merchant",merchantId:jQuery('[id="ckoGooglePayMerchantId"]').val()},paymentDataCallbacks:{onPaymentAuthorized:I,onPaymentDataChanged:S}})),d}function f(){const t=Object.assign({},e);return t.allowedPaymentMethods=[i],t.transactionInfo=P(),t.merchantInfo={merchantName:"Example Merchant"},t.emailRequired=!0,t.callbackIntents=["SHIPPING_ADDRESS","SHIPPING_OPTION","PAYMENT_AUTHORIZATION"],t.shippingAddressRequired=!0,t.shippingAddressParameters={phoneNumberRequired:!0},t.shippingOptionRequired=!0,t}function P(e){var t;if(t=l?parseFloat(jQuery('[id="ckoProductPrice"]').val())+l:jQuery('[id="ckoProductPrice"]').val(),e)var a=h[e],o="-"+c[e];var n={displayItems:[{label:"Subtotal",type:"SUBTOTAL",price:t.toString()},{label:"Tax",type:"TAX",price:a||"0.00"}],currencyCode:jQuery('[id="ckoGooglePayCurrency"]').val(),totalPriceStatus:"FINAL",totalPrice:jQuery('[id="ckoProductPrice"]').val(),totalPriceLabel:"Total"};if(e&&parseFloat(c[e])>0){var r={label:"Discounts",type:"DISCOUNT",price:o||"0.00"};n.displayItems.push(r)}return n}function I(e){return new Promise((function(t,a){(function(e){return new Promise((function(t,a){setTimeout((function(){var a={signature:JSON.parse(e.paymentMethodData.tokenizationData.token).signature,protocolVersion:JSON.parse(e.paymentMethodData.tokenizationData.token).protocolVersion,signedMessage:JSON.parse(e.paymentMethodData.tokenizationData.token).signedMessage},o=e.shippingAddress,n=e.shippingOptionData;jQuery("#ckoGooglePayData").val(JSON.stringify(a));var r={ckoGooglePayData:JSON.stringify(a),shippingAddress:JSON.stringify(o),shippingMethod:JSON.stringify(n),email:e.email};""===$('input[name="dwfrm_billing_googlePayForm_ckoGooglePayData"]').val()?$("#google-pay-content .invalid-field-message").text(window.ckoLang.googlePayDataInvalid):$.ajax({url:document.getElementById("ckoGooglePayExpressCheckout").value,data:r,method:"POST",success:function(e){if(e.error){var t=location.href,a=new URL(t).searchParams.has("hasError");sessionStorage.setItem("reloading","true"),location.href=a?location.href:location.href+"&hasError=true"}else e.redirectUrl?location.href=e.redirectUrl:document.getElementsByClassName("page")[0].innerHTML=e},error:function(e){console.log(e)}}),t({})}),3e3)}))})(e).then((function(){t({transactionState:"SUCCESS"})})).catch((function(){t({transactionState:"ERROR",error:{intent:"PAYMENT_AUTHORIZATION",message:"Insufficient funds",reason:"PAYMENT_DATA_INVALID"}})}))}))}function S(e){return new Promise((function(t,a){let o=e.shippingAddress,n=e.shippingOptionData,r={};var i={firstName:"",lastName:"",address1:"",address2:"",stateCode:o.administrativeArea,city:o.locality,postalCode:o.postalCode,countryCode:o.countryCode,phone:""},s={address:JSON.stringify(i)};if($.ajax({type:"POST",async:!1,data:s,url:document.getElementById("ckoGetShippingMethods").value,success:function(e){p=e.shipCosts,u=e.shipMethods,h=e.salesTax,c=e.discounts;var t=!1;(g=e.defaultShippingMethod)in p&&(t=!0),t||(g=Object.keys(p)[0])},error:function(e){console.log(e)}}),"INITIALIZE"==e.callbackTrigger||"SHIPPING_ADDRESS"==e.callbackTrigger)if("NJ"==o.administrativeArea)r.error={reason:"SHIPPING_ADDRESS_UNSERVICEABLE",message:"Cannot ship to the selected address",intent:"SHIPPING_ADDRESS"};else{r.newShippingOptionParameters={defaultSelectedOptionId:g,shippingOptions:u};let e=r.newShippingOptionParameters.defaultSelectedOptionId;r.newTransactionInfo=N(e)}else"SHIPPING_OPTION"==e.callbackTrigger&&(r.newTransactionInfo=N(n.id));t(r)}))}function N(e){let t=P(e),a=p[e];t.displayItems.push({type:"LINE_ITEM",label:"Shipping cost",price:a,status:"FINAL"});let o=0;return t.displayItems.forEach((e=>o+=parseFloat(e.price))),t.totalPrice=o.toFixed(2).toString(),t}y.transactionInfo=P(),d=m(),d.loadPaymentData(y).then((function(e){})).catch((function(e){location.reload(),console.log(e)}))}))}document.addEventListener("DOMContentLoaded",(function(){launchGooglePay(),$(document).ready((function(){sessionStorage.getItem("reloading")&&(sessionStorage.removeItem("reloading"),new URL(location.href).searchParams.get("hasError")&&jQuery(".pdp-googlepay-error").show("fast",(function(){setTimeout((function(){jQuery(".pdp-googlepay-error").hide("fast")}),7e3)})))}))}),!1);