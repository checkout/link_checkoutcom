"use strict";function initKlarnaEvent(){$(".cko-apm-accordion.klarna").on("click touch",function(){resetFormErrors(),validateEmail()&&validatePhone()&&callKlarnaController()})}function resetFormErrors(){$(".contact-info-block .is-invalid").each(function(){$(this).removeClass("is-invalid")})}function validateEmail(){var a=$('input[name$="dwfrm_billing_contactInfoFields_email"]');return""!==a.val()||($("#emailInvalidMessage").text(window.ckoLang.apmEmailInvalid),a.addClass("is-invalid"),!1)}function validatePhone(){var a=$('input[name$="dwfrm_billing_contactInfoFields_phone"]');return""!==a.val()||($("#phoneInvalidMessage").text(window.ckoLang.apmPhoneNumberInvalid),a.addClass("is-invalid"),!1)}function callKlarnaController(){var a=jQuery('[id="ckoKlarnaController"]').val();if(a){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var a=JSON.parse(this.responseText).session_id,e=JSON.parse(this.responseText).client_token,n=JSON.parse(this.responseText).payment_method_categories,i=JSON.parse(this.responseText).requestObject,t=JSON.parse(this.responseText).addressInfo;Klarna.Payments.init({client_token:e});var r=$("#klarna-buttons");r.empty();for(var o=0;o<n.length;o++){var l="<div class='klarna-button'> "+n[o].name+" <input type='radio' name='payment_method_categories' value='"+n[o].identifier+"' id='"+n[o].identifier+"' onclick='loadKlarna(`"+n[o].identifier+"`, `"+JSON.stringify(i)+"`,  `"+JSON.stringify(t)+"` ,`"+a+"` )'><img src='"+n[o].asset_urls.descriptive+"' id='"+n[o].identifier+"_image'><p id='"+n[o].identifier+"_aproved' class='klarnaAproved'><span>&#10003;</span><span>Klarna</span></p><p class='klarnaFail' id='"+n[o].identifier+"_rejected'><span class='ckoaproved'>&#10007;</span><span>Klarna</span></p><div>";r.append(l)}}},e.open("GET",a,!0),e.send()}}function loadKlarna(a,e,n,i){e=JSON.parse(e),n=JSON.parse(n);$("#klarna-payments-container").empty(),Klarna.Payments.load({container:"#klarna-payments-container",payment_method_category:a,instance_id:i},function(t){klarnaAuthorizeButton("#klarna-payments-container",i,a,n,e)})}function klarnaAuthorizeButton(a,e,n,i,t){var r="<button id='klarna_authorize_btn' type='button' onclick='klarnaAuthorize(`"+e+"`, `"+a+"`, `"+n+"`, ` "+JSON.stringify(i)+" ` , ` "+JSON.stringify(t)+" `)'>Authorize</button>";$(a).append(r)}function klarnaAuthorize(a,e,n,i,t){var r=JSON.parse(t),o=JSON.parse(i);o.email=r.billing_address.email,Klarna.Payments.authorize({instance_id:a,auto_finalize:!1,payment_method_category:n},{purchase_country:r.purchase_country,purchase_currency:r.currency,locale:r.locale,billing_address:o,order_amount:r.amount,order_tax_amount:r.tax_amount,order_lines:r.products},function(a){a.approved?($(e).empty(),$("#"+n+"_image").hide(),$("#"+n+"_aproved").show(),$("#"+n+"_rejected").hide(),$("#klarna_token").val(a.authorization_token),$("#klarna_approved").val(a.approved),$("#klarna_finalize_required").val(a.finalize_required)):($(e).empty(),$("#"+n+"_image").hide(),$("#"+n+"_rejected").show(),$("#"+n+"_aproved").hide(),$("#klarna_token").val(a.authorization_token),$("#klarna_approved").val(a.approved),$("#klarna_finalize_required").val(a.finalize_required))})}document.addEventListener("DOMContentLoaded",function(){initKlarnaEvent()},!1);