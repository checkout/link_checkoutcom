"use strict";function initButtons(){jQuery(".ckoModal .modal-content .close").click((function(e){jQuery(".ckoModal .modal-content input").val(""),jQuery(".ckoModal .modal-content span").not(".close, .label").empty(),jQuery(".ckoModal").hide()})),document.addEventListener("click",(function(e){if("string"==typeof e.target.className&&-1!==e.target.className.indexOf("ckoAction")){if(e.detail>1)return;openModal(e.target)}}),!0),jQuery(".ckoModal .modal-content .submit").click((function(){performAction(jQuery(this).closest(".modal-content").find("input").attr("id").split("_")[0])}))}function openModal(e){var t=e.id.split("-"),a=null!==t[2]&&"undefined"!==t[2],n=t[2].length>0&&0===t[2].indexOf("pay_");a&&n?getTransactionData(t):alert(window.ckoLang.transactionMissing)}function getTransactionData(e){var t=jQuery('[id="transactionsControllerUrl"]').val(),a=e[0],n=e[2],o='[id="'+a+'_modal"]',r=document.getElementById("year").value;jQuery.ajax({type:"POST",url:t,data:{tid:n,year:r},success:function(e){var t=JSON.parse(e).data[0],n='[id="'+a+'_value"]',r='[id="'+a+'_currency"]',u='[id="'+a+'_transaction_id"]',c='[id="'+a+'_payment_id"]',i='[id="'+a+'_full_amount"]',d='[id="'+a+'_order_no"]',s='[id="'+a+'_refundable_amount"]',l='[id="'+a+'_captured_amount"]',y=(t.amount-parseFloat(t.captured_amount)).toFixed(2);jQuery(n).on("change",(function(){var e=jQuery(this).val(),t=jQuery("#refund_refundable_amount").val();"refund"===a?parseFloat(e)>parseFloat(t)&&jQuery(this).val(t):"capture"===a&&parseFloat(e)>parseFloat(y)&&jQuery(this).val(y.toString())})),"capture"===a?jQuery(n).val(y.toString()):jQuery(n).val(t.refundable_amount),jQuery(l).append(t.captured_amount+" "+t.currency),jQuery(r).append(t.currency),jQuery(u).append(t.transaction_id),jQuery(c).append(t.action_id),jQuery(i).append(t.amount+" "+t.currency),jQuery(d).append(t.order_no),jQuery(s).append(t.refundable_amount+" "+t.currency),jQuery(s).val(t.refundable_amount),jQuery(o).show()},error:function(e,t,a){console.log(a)}})}function showErrorMessage(e){jQuery("."+e).show("fast",(function(){setTimeout((function(){jQuery("."+e).hide()}),7e3)}))}function performAction(e){var t=jQuery('[id="actionControllerUrl"]').val(),a=jQuery('[id="'+e+'_payment_id"]').text(),n=jQuery('[id="'+e+'_currency"]').text(),o=jQuery('[id="'+e+'_value"]').val(),r=jQuery('[id="'+e+'_order_no"]').text();-1==a.indexOf("pay_")&&(a=jQuery('[id="'+e+'_transaction_id"]').text());var u={pid:a,task:e,amount:o,currency:n,orderNo:r};jQuery.ajax({type:"POST",url:t,data:u,success:function(e){JSON.parse(e)?(jQuery(".ckoModal .modal-content .close").trigger("click"),getTransactions(reloadTable)):showErrorMessage("ckoErrorMessage")},error:function(e,t,a){console.log(a)}})}function reloadTable(e){var t=JSON.parse(e);window.ckoTransactionsTable.replaceData(t.data),showSuccessMessage()}function showSuccessMessage(){jQuery(".ckoSuccessMessage").show("fast",(function(){setTimeout((function(){jQuery(".ckoSuccessMessage").hide("fast")}),7e3)}))}document.addEventListener("DOMContentLoaded",(function(){initButtons()}),!1);