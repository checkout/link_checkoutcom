"use strict";function initButtons(){jQuery(".ckoModal .modal-content .close").click((function(e){jQuery(".ckoModal .modal-content input").val(""),jQuery(".ckoModal .modal-content span").not(".close, .label").empty(),jQuery(".ckoModal").hide()})),document.addEventListener("click",(function(e){if("string"==typeof e.target.className&&-1!==e.target.className.indexOf("ckoAction")){if(e.detail>1)return;openModal(e.target)}}),!0),jQuery(".ckoModal .modal-content .submit").click((function(){performAction(jQuery(this).closest(".modal-content").find("input").attr("id").split("_")[0])}))}function openModal(e){var r=e.id.split("-"),a=null!==r[2]&&"undefined"!==r[2],o=r[2].length>0&&0===r[2].indexOf("pay_");a&&o?getTransactionData(r):alert(window.ckoLang.transactionMissing)}function getTransactionData(e){var r=jQuery('[id="transactionsControllerUrl"]').val(),a=e[0],o=e[2],t='[id="'+a+'_modal"]',n=document.getElementById("year").value;jQuery.ajax({type:"POST",url:r,data:{tid:o,year:n},success:function(e){var r=JSON.parse(e).data[0],o='[id="'+a+'_value"]',n='[id="'+a+'_currency"]',c='[id="'+a+'_transaction_id"]',u='[id="'+a+'_payment_id"]',s='[id="'+a+'_full_amount"]',i='[id="'+a+'_order_no"]',d='[id="'+a+'_refundable_amount"]',l='[id="'+a+'_captured_amount"]',y=(r.amount-parseFloat(r.captured_amount)).toFixed(2);jQuery(o).on("change",(function(){var e=jQuery(this).val(),o=jQuery("#refund_refundable_amount").val();"refund"===a?parseFloat(e)>parseFloat(o)&&showExceedMessage("ckoRefundErrorMessage",a,o,r.currency):"capture"===a&&parseFloat(e)>parseFloat(y)&&showExceedMessage("ckoCaptureErrorMessage",a,y,r.currency)})),"capture"===a?jQuery(o).val(y.toString()):jQuery(o).val(r.refundable_amount),jQuery(l).append(r.captured_amount+" "+r.currency),jQuery(n).append(r.currency),jQuery(c).append(r.transaction_id),jQuery(u).append(r.action_id),jQuery(s).append(r.amount+" "+r.currency),jQuery(i).append(r.order_no),jQuery(d).append(r.refundable_amount+" "+r.currency),jQuery(d).val(r.refundable_amount),jQuery(t).show()},error:function(e,r,a){console.log(a)}})}function showExceedMessage(e,r,a,o){"capture"===r?document.getElementById("capAmount").innerHTML=" "+a+" "+o+".":"refund"===r&&(document.getElementById("refAmount").innerHTML=" "+a+" "+o+"."),jQuery("."+e).show("fast",(function(){setTimeout((function(){jQuery("."+e).hide()}),7e3)}))}function showErrorMessage(e){jQuery("."+e).show("fast",(function(){setTimeout((function(){jQuery("."+e).hide()}),7e3)}))}function performAction(e){var r=jQuery('[id="actionControllerUrl"]').val(),a=jQuery('[id="'+e+'_payment_id"]').text(),o=jQuery('[id="'+e+'_currency"]').text(),t=jQuery('[id="'+e+'_value"]').val(),n=jQuery('[id="'+e+'_order_no"]').text();if(-1==a.indexOf("pay_")&&(a=jQuery('[id="'+e+'_transaction_id"]').text()),"capture"===e){var c=jQuery('[id="'+e+'_captured_amount"]').text().split(" "),u=(jQuery('[id="'+e+'_full_amount"]').text().split(" ")[0]-parseFloat(c[0])).toFixed(2);if(parseFloat(t)>parseFloat(u))showExceedMessage("ckoCaptureErrorMessage",e,u,o);else{var s={pid:a,task:e,amount:t,currency:o,orderNo:n};jQuery.ajax({type:"POST",url:r,data:s,success:function(e){JSON.parse(e)?(jQuery(".ckoModal .modal-content .close").trigger("click"),getTransactions(reloadTable)):showErrorMessage("ckoErrorMessage")},error:function(e,r,a){console.log(a)}})}}else if("refund"===e){var i=jQuery('[id="'+e+'_refundable_amount"]').text().split(" ");parseFloat(t)>parseFloat(i[0])?showExceedMessage("ckoRefundErrorMessage",e,i[0],o):(s={pid:a,task:e,amount:t,currency:o,orderNo:n},jQuery.ajax({type:"POST",url:r,data:s,success:function(e){JSON.parse(e)?(jQuery(".ckoModal .modal-content .close").trigger("click"),getTransactions(reloadTable)):showErrorMessage("ckoErrorMessage")},error:function(e,r,a){console.log(a)}}))}else s={pid:a,task:e,amount:t,currency:o,orderNo:n},jQuery.ajax({type:"POST",url:r,data:s,success:function(e){JSON.parse(e)?(jQuery(".ckoModal .modal-content .close").trigger("click"),getTransactions(reloadTable)):showErrorMessage("ckoErrorMessage")},error:function(e,r,a){console.log(a)}})}function reloadTable(e){var r=JSON.parse(e);console.log(r.data),window.ckoTransactionsTable.replaceData(r.data),showSuccessMessage()}function showSuccessMessage(){jQuery(".ckoSuccessMessage").show("fast",(function(){setTimeout((function(){jQuery(".ckoSuccessMessage").hide("fast")}),7e3)}))}document.addEventListener("DOMContentLoaded",(function(){initButtons()}),!1);