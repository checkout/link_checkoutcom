"use strict";function initApmAccordion(){var e,a=document.getElementsByClassName("cko-apm-accordion");for(e=0;e<a.length;e++)a[e].addEventListener("click",function(){$(".cko-apm-accordion").removeClass("cko-apm-active"),$(".cko-apm-panel").css("display","none"),this.classList.toggle("cko-apm-active");var e=this.nextElementSibling,a=this.querySelector('input[name="apm_list"');a.checked=!0,$("#dwfrm_alternativePaymentForm_alternative__payments").val(a.value),e&&(e.style.minHeight?(e.style.minHeight=null,e.style.display="block"):(e.style.minHeight=e.scrollHeight+"px",e.style.display="block"))})}function alternativePaymentsFilter(){var e=$("#ckoApmFilterUrl").val(),a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=JSON.parse(this.responseText),a=e.filterObject,n=e.ckoApmFilterConfig;for(var t in n){var r=n[t].countries.includes(a.country.toUpperCase()),i=n[t].countries.includes("*"),s=n[t].currencies.includes(a.currency);(r||i)&&s&&$("#"+t).show()}}},a.open("GET",e,!0),a.send()}function callKlarnaController(e){if(e){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=JSON.parse(this.responseText).session_id,a=JSON.parse(this.responseText).client_token,n=JSON.parse(this.responseText).payment_method_categories,t=JSON.parse(this.responseText).requestObject,r=JSON.parse(this.responseText).addressInfo;Klarna.Payments.init({client_token:a});var i=$("#klarna-buttons");i.empty();for(var s=0;s<n.length;s++){var o="<div class='klarnaButton'> <p>"+n[s].name+"</p><input type='radio' name='payment_method_categories' value='"+n[s].identifier+"' id='"+n[s].identifier+"' onclick='loadKlarna(`"+n[s].identifier+"`, `"+JSON.stringify(t)+"`,  `"+JSON.stringify(r)+"` ,`"+e+"` )'><img src='"+n[s].asset_urls.descriptive+"' alt='Klarna' id='"+n[s].identifier+"_image' class='klarnaLogo'> <div id='"+n[s].identifier+"_aproved' class='klarnaAproved'><span> &#10003;</span><span class='klarnaBlack'>Klarna</span></div> <div class='klarnaFail' id='"+n[s].identifier+"_rejected'><span> &#10007;</span><span class='klarnaBlack'>Klarna</span></div><div>";i.append(o)}}},a.open("GET",e,!0),a.send()}}function loadKlarna(e,a,n,t){a=JSON.parse(a),n=JSON.parse(n);$("#klarna-payments-container").empty(),Klarna.Payments.load({container:"#klarna-payments-container",payment_method_category:e,instance_id:t},function(r){klarnaAuthorizeButton("#klarna-payments-container",t,e,n,a)})}function klarnaAuthorizeButton(e,a,n,t,r){var i=$("#klarnaConfirmBtn");i.show(),i.click(function(){klarnaAuthorize(a,e,n,JSON.stringify(t),JSON.stringify(r)),$(this).hide()})}function klarnaAuthorize(e,a,n,t,r){var i=JSON.parse(r),s=JSON.parse(t),o=$('input[name$="dwfrm_billing_billingAddress_email_emailAddress"]').val();s.email=o,Klarna.Payments.authorize({instance_id:e,auto_finalize:!1,payment_method_category:n},{purchase_country:i.purchase_country,purchase_currency:i.currency,locale:i.locale,billing_address:s,order_amount:i.amount,order_tax_amount:i.tax_amount,order_lines:i.products},function(e){e.approved?($(a).empty(),$("#"+n+"_image").hide(),$("#"+n+"_aproved").show(),$("#"+n+"_rejected").hide(),$("#dwfrm_alternativePaymentForm_klarna__token").val(e.authorization_token),$("#dwfrm_alternativePaymentForm_klarna__approved").val(e.approved),$("#dwfrm_alternativePaymentForm_klarna__finalize__required").val(e.finalize_required)):($(a).empty(),$("#"+n+"_image").hide(),$("#"+n+"_rejected").show(),$("#"+n+"_aproved").hide(),$("#dwfrm_alternativePaymentForm_klarna__token").val(e.authorization_token),$("#dwfrm_alternativePaymentForm_klarna__approved").val(e.approved),$("#dwfrm_alternativePaymentForm_klarna__finalize__required").val(e.finalize_required))})}document.addEventListener("DOMContentLoaded",function(){alternativePaymentsFilter(),initApmAccordion()},!1);